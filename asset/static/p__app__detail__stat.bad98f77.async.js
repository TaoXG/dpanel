"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[7745,5947],{55809:function(N,M,e){var T=e(87462),r=e(67294),L=e(44805),_=e(84089),h=function(O,g){return r.createElement(_.Z,(0,T.Z)({},O,{ref:g,icon:L.Z}))},b=r.forwardRef(h);M.Z=b},60433:function(N,M,e){var T=e(87462),r=e(67294),L=e(69782),_=e(84089),h=function(O,g){return r.createElement(_.Z,(0,T.Z)({},O,{ref:g,icon:L.Z}))},b=r.forwardRef(h);M.Z=b},27619:function(N,M,e){e.d(M,{Z:function(){return A}});var T=e(97857),r=e.n(T),L=e(19632),_=e.n(L),h=e(5574),b=e.n(h),R=e(64183),O=e(82346),g=e(67294),y=e(85893);function A(c){var P,E=(0,g.useState)("academy"),x=b()(E,2),k=x[0],I=x[1],F=Math.max.apply(Math,_()(c.data.map(function(d){var a;return(a=d[c.yField])!==null&&a!==void 0?a:0}))),m=(0,O.useModel)("@@initialState"),j=m.initialState,K=m.loading,D=m.error,Z=m.refresh,o=m.setInitialState,t={xField:c.xField,yField:c.yField,height:200,axis:{y:{line:!0},x:{line:!0,grid:{visable:!0},labelAutoRotate:!0}},style:{opacity:.4},tooltip:{channel:"y",valueFormatter:c.yLabelFormatter},scale:{y:{domainMin:(P=c.yDomainMin)!==null&&P!==void 0?P:0,domainMax:c.yDomainMax?c.yDomainMax:c.yDomainMaxCallback?c.yDomainMaxCallback(F):F}},data:c.data};return c.yLabelFormatter&&(t.axis.y.labelFormatter=c.yLabelFormatter),c.colorField&&(t.colorField=c.colorField),(0,g.useEffect)(function(){(j==null?void 0:j.theme.algorithm)=="dark"?I("classicDark"):I("academy")},[j]),(0,y.jsx)(R.Z,r()({theme:k},t))}},24963:function(N,M,e){var T=e(67294),r=(0,T.createContext)({});M.Z=r},50070:function(N,M,e){e.r(M),e.d(M,{AppDetailContext:function(){return x},default:function(){return k}});var T=e(15009),r=e.n(T),L=e(99289),_=e.n(L),h=e(5574),b=e.n(h),R=e(24963),O=e(60335),g=e(55809),y=e(82346),A=e(25593),c=e(50136),P=e(67294),E=e(85893),x=(0,P.createContext)({});function k(){var I,F=(0,P.useContext)(R.Z),m=F.lang,j=F.loading,K=F.message,D=(0,y.useParams)(),Z=(0,y.useSearchParams)(),o=b()(Z,2),t=o[0],d=o[1],a=(I=t.get("tab"))!==null&&I!==void 0?I:"edit",q=(0,P.useState)("edit"),C=b()(q,2),B=C[0],U=C[1],p=(0,y.useNavigate)(),$=(0,P.useState)(1),w=b()($,2),u=w[0],V=w[1],z=[{label:(0,E.jsx)(y.Link,{to:"/app/detail/edit/".concat(D.id,"?tab=edit"),children:"\u5BB9\u5668\u8BE6\u60C5"}),key:"edit"},{label:(0,E.jsx)(y.Link,{to:"/app/detail/network/".concat(D.id,"?tab=network"),children:"\u7F51\u7EDC\u7BA1\u7406"}),key:"network"},{label:(0,E.jsx)(A.Z.Link,{children:"\u6587\u4EF6\u7BA1\u7406"}),key:"file",onClick:function(){K.info(m("app.detail.createExplorerPlugin")),p("/app/detail/file/".concat(D.id,"?tab=file"))}},{label:(0,E.jsx)(A.Z.Link,{children:"\u8FD0\u884C\u65E5\u5FD7"}),key:"log",onClick:function(){p("/app/detail/log/".concat(D.id,"?tab=log"))}},{label:(0,E.jsx)(A.Z.Link,{children:"\u8FD0\u884C\u72B6\u6001"}),key:"stat",onClick:function(){p("/app/detail/stat/".concat(D.id,"?tab=stat"))}},{label:"",key:"containerName",icon:(0,E.jsx)(g.Z,{}),disabled:!0}],S=(0,P.useState)(z),G=b()(S,2),J=G[0],Y=G[1];(0,P.useEffect)(function(){j.show(),U(a);var l=function(){var Q=_()(r()().mark(function ee(){var X,v,s;return r()().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return v=z,f.next=3,(0,O.jV)({md5:(X=D.id)!==null&&X!==void 0?X:""});case 3:s=f.sent,v.map(function(i){return i.key=="containerName"&&(i.label=s.data.info.Name),(!s.data.info.State.Running||s.data.info.State.Restarting)&&(i.key=="file"||i.key=="stat")&&(i.disabled=!0),i}),Y(v),j.destroy();case 7:case"end":return f.stop()}},ee)}));return function(){return Q.apply(this,arguments)}}();l()},[u]);var H=function(Q){U(Q.key)};return(0,E.jsxs)(x.Provider,{value:{reload:function(){V(u+1)}},children:[(0,E.jsx)(c.Z,{mode:"horizontal",onClick:H,selectedKeys:[B],items:J}),(0,E.jsx)(y.Outlet,{})]})}},41748:function(N,M,e){e.r(M),e.d(M,{default:function(){return q}});var T=e(15009),r=e.n(T),L=e(99289),_=e.n(L),h=e(5574),b=e.n(h),R=e(19632),O=e.n(R),g=e(27619),y=e(67294);function A(C){var B=C.reqFunction,U=C.interval,p=C.maxPolling,$=C.pollingStatus,w=C.inPath,u=(0,y.useRef)(null),V=0,z=function G(){u.current=window.setTimeout(_()(r()().mark(function J(){var Y;return r()().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:if(!(V++>=p)){l.next=3;break}return S(),l.abrupt("return");case 3:if(l.prev=3,!(w&&window.location.href.indexOf(w)==-1)){l.next=7;break}return S(),l.abrupt("return");case 7:return l.next=9,B();case 9:Y=l.sent,G(),l.next=17;break;case 13:l.prev=13,l.t0=l.catch(3),S(),console.error("\u8F6E\u8BE2\u53D1\u751F\u9519\u8BEF\uFF1A",l.t0);case 17:case"end":return l.stop()}},J,null,[[3,13]])})),U)},S=function(){console.log("end polling"),u.current&&window.clearTimeout(u.current)};return(0,y.useEffect)(function(){return console.log(($?"start":"waiting")+" polling, max "+p),$&&z(),function(){S()}},[U,p,$]),{endPolling:S}}var c=A,P=e(24963),E=e(82346);function x(C){return k.apply(this,arguments)}function k(){return k=_()(r()().mark(function C(B){return r()().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return p.abrupt("return",(0,E.request)("/api/app/container/get-stat-info",{method:"POST",data:B}));case 1:case"end":return p.stop()}},C)})),k.apply(this,arguments)}function I(C){return F.apply(this,arguments)}function F(){return F=_()(r()().mark(function C(B){return r()().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return p.abrupt("return",(0,E.request)("/api/app/container/get-process-info",{method:"POST",data:B}));case 1:case"end":return p.stop()}},C)})),F.apply(this,arguments)}var m=e(5251),j=e(12122),K=e(60433),D=e(38345),Z=e(60940),o=e(50070),t=e(85893),d=new Date().toLocaleTimeString(),a={total:0,memory:[{date:d,usage:0,source:{usage:0,limit:0}}],cpu:[{date:d,usage:0}],network:[{usage:0,type:"rx",date:d,source:{usage:0}},{usage:0,type:"tx",date:d,source:{usage:0}}],io:[{usage:0,type:"read",date:d,source:{usage:0}},{usage:0,type:"write",date:d,source:{usage:0}}]};function q(){var C=function(s,n){switch(n.type){case"update":var f=new Date(n.payload.read).toLocaleTimeString(),i=n.payload.cpu_stats.cpu_usage.total_usage-n.payload.precpu_stats.cpu_usage.total_usage,ae=n.payload.cpu_stats.system_cpu_usage-n.payload.precpu_stats.system_cpu_usage,W={total:s.total+1,memory:[],cpu:[].concat(O()(s.cpu),[{date:f,usage:i/ae*n.payload.cpu_stats.online_cpus*100}]),io:[],network:[]};return n.payload.memory_stats&&n.payload.memory_stats.limit&&n.payload.memory_stats.usage&&(W.memory=[].concat(O()(s.memory),[{date:f,usage:Math.round(n.payload.memory_stats.usage),source:{usage:n.payload.memory_stats.usage,limit:n.payload.memory_stats.limit}}])),n.payload.networks&&(W.network=[].concat(O()(s.network),[{date:f,usage:parseFloat(n.payload.networks.eth0.rx_bytes.toFixed(2)),type:"rx",source:{usage:n.payload.networks.eth0.rx_bytes}},{date:f,usage:parseFloat(n.payload.networks.eth0.tx_bytes.toFixed(2)),type:"tx",source:{usage:n.payload.networks.eth0.tx_bytes}}])),n.payload.blkio_stats&&n.payload.blkio_stats.io_service_bytes_recursive&&n.payload.blkio_stats.io_service_bytes_recursive.length>0&&(W.io=[].concat(O()(s.io),[{date:f,usage:parseFloat(n.payload.blkio_stats.io_service_bytes_recursive[0].value.toFixed(2)),type:n.payload.blkio_stats.io_service_bytes_recursive[0].op,source:{usage:n.payload.blkio_stats.io_service_bytes_recursive[0].value}},{date:f,usage:parseFloat(n.payload.blkio_stats.io_service_bytes_recursive[1].value.toFixed(2)),type:n.payload.blkio_stats.io_service_bytes_recursive[1].op,source:{usage:n.payload.blkio_stats.io_service_bytes_recursive[1].value}}])),W}},B=(0,y.useContext)(P.Z),U=B.loading,p=(0,E.useParams)(),$=(0,y.useReducer)(C,a),w=b()($,2),u=w[0],V=w[1],z=(0,y.useState)(0),S=b()(z,2),G=S[0],J=S[1],Y=(0,y.useState)(),H=b()(Y,2),l=H[0],Q=H[1],ee=c({reqFunction:function(){var v=_()(r()().mark(function n(){var f,i;return r()().wrap(function(W){for(;;)switch(W.prev=W.next){case 0:return W.next=2,x({id:(f=p.id)!==null&&f!==void 0?f:""});case 2:i=W.sent,U.destroy(),V({type:"update",payload:i});case 5:case"end":return W.stop()}},n)}));function s(){return v.apply(this,arguments)}return s}(),interval:3e3,maxPolling:999,pollingStatus:G!=0,inPath:"tab=stat"}),X=(0,y.useContext)(o.AppDetailContext);return(0,y.useEffect)(function(){X.reload()},[]),(0,y.useEffect)(function(){var v,s;U.show(),x({id:(v=p.id)!==null&&v!==void 0?v:""}).then(function(n){return J(Math.round(n.memory_stats.limit)),!0}),I({id:(s=p.id)!==null&&s!==void 0?s:""}).then(function(n){var f={columns:[],data:[]};n.data.list.Titles.map(function(i){f.columns.push({title:i,label:i,dataIndex:i})}),n.data.list.Processes.map(function(i,ae){f.data.push({UID:i[0],PID:i[1],PPID:i[2],C:i[3],STIME:i[4],TTY:i[5],TIME:i[6],CMD:i[7]})}),Q(f)})},[]),(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(D.Z,{direction:"row",wrap:!0,gutter:[20,20],children:[u.memory&&u.memory.length>0&&(0,t.jsx)(D.Z,{colSpan:12,title:(0,t.jsx)(j.Z,{}),subTitle:"Memory usage: ".concat((0,m.FI)(u.memory[u.memory.length-1].source.usage)," / ").concat((0,m.FI)(u.memory[u.memory.length-1].source.limit)),headerBordered:!0,bordered:!0,children:(0,t.jsx)(g.Z,{yField:"usage",xField:"date",data:u.memory,yDomainMaxCallback:function(s){return s*2},yLabelFormatter:function(s){return(0,m.FI)(parseFloat(s))}})}),(0,t.jsx)(D.Z,{colSpan:12,title:(0,t.jsx)(j.Z,{}),subTitle:"Cpu usage: ".concat(u.cpu[u.cpu.length-1].usage.toFixed(2),"%"),headerBordered:!0,bordered:!0,children:(0,t.jsx)(g.Z,{yField:"usage",xField:"date",data:u.cpu,yDomainMaxCallback:function(s){return s*1.5},yLabelFormatter:function(s){return"".concat(s,"%")}})}),u.io&&u.io.length>0&&(0,t.jsx)(D.Z,{colSpan:12,title:(0,t.jsx)(j.Z,{}),subTitle:"I/O: ".concat((0,m.FI)(u.io[u.io.length-1].source.usage)," / ").concat((0,m.FI)(u.io[u.io.length-2].source.usage)),headerBordered:!0,bordered:!0,children:(0,t.jsx)(g.Z,{yField:"usage",xField:"date",colorField:"type",data:u.io,yDomainMaxCallback:function(s){return s*2},yLabelFormatter:function(s){return(0,m.FI)(parseFloat(s))}})}),u.network&&u.network.length>0&&(0,t.jsx)(D.Z,{colSpan:12,title:(0,t.jsx)(j.Z,{}),subTitle:"Network: ".concat((0,m.FI)(u.network[u.network.length-1].source.usage)," / ").concat((0,m.FI)(u.network[u.network.length-2].source.usage)),headerBordered:!0,bordered:!0,children:(0,t.jsx)(g.Z,{yField:"usage",xField:"date",colorField:"type",data:u.network,yDomainMaxCallback:function(s){return s*2},yLabelFormatter:function(s){return(0,m.FI)(parseFloat(s))}})})]}),(0,t.jsx)(D.Z,{title:(0,t.jsx)(K.Z,{}),subTitle:"Progress",children:(0,t.jsx)(Z.Z,{scroll:{x:"max-content"},rowKey:"PID",columns:l==null?void 0:l.columns,dataSource:l==null?void 0:l.data,pagination:{pageSize:10}})})]})}},60335:function(N,M,e){e.d(M,{IE:function(){return O},IW:function(){return b},KK:function(){return E},LJ:function(){return k},RF:function(){return j},Re:function(){return F},aF:function(){return D},eE:function(){return c},jV:function(){return y}});var T=e(15009),r=e.n(T),L=e(99289),_=e.n(L),h=e(82346);function b(o){return R.apply(this,arguments)}function R(){return R=_()(r()().mark(function o(t){return r()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,h.request)("/api/app/container/status",{method:"POST",data:t}));case 1:case"end":return a.stop()}},o)})),R.apply(this,arguments)}function O(o){return g.apply(this,arguments)}function g(){return g=_()(r()().mark(function o(t){return r()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,h.request)("/api/app/container/get-list",{data:t,method:"POST"}));case 1:case"end":return a.stop()}},o)})),g.apply(this,arguments)}function y(o){return A.apply(this,arguments)}function A(){return A=_()(r()().mark(function o(t){return r()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,h.request)("/api/app/container/get-detail",{data:t,method:"POST"}));case 1:case"end":return a.stop()}},o)})),A.apply(this,arguments)}function c(o){return P.apply(this,arguments)}function P(){return P=_()(r()().mark(function o(t){return r()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,h.request)("/api/app/container/update",{data:t,method:"POST"}));case 1:case"end":return a.stop()}},o)})),P.apply(this,arguments)}function E(){return x.apply(this,arguments)}function x(){return x=_()(r()().mark(function o(){return r()().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return d.abrupt("return",(0,h.request)("/api/app/container/prune",{method:"POST"}));case 1:case"end":return d.stop()}},o)})),x.apply(this,arguments)}function k(o){return I.apply(this,arguments)}function I(){return I=_()(r()().mark(function o(t){return r()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,h.request)("/api/app/container/export",{method:"POST",data:t,responseType:"blob"}));case 1:case"end":return a.stop()}},o)})),I.apply(this,arguments)}function F(o){return m.apply(this,arguments)}function m(){return m=_()(r()().mark(function o(t){return r()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,h.request)("/api/app/container/commit",{method:"POST",data:t}));case 1:case"end":return a.stop()}},o)})),m.apply(this,arguments)}function j(o){return K.apply(this,arguments)}function K(){return K=_()(r()().mark(function o(t){return r()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,h.request)("/api/app/container/upgrade",{method:"POST",data:t}));case 1:case"end":return a.stop()}},o)})),K.apply(this,arguments)}function D(o){return Z.apply(this,arguments)}function Z(){return Z=_()(r()().mark(function o(t){return r()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,h.request)("/api/app/container/copy",{method:"POST",data:t}));case 1:case"end":return a.stop()}},o)})),Z.apply(this,arguments)}}}]);
