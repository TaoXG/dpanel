"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[3917],{80821:function(z,C,n){n.d(C,{Z:function(){return M}});var _=n(5574),l=n.n(_),p=n(24963),g=n(86738),E=n(28036),x=n(83062),O=n(67294),f=n(85893);function M(t){var B=(0,O.useState)(!1),W=l()(B,2),P=W[0],S=W[1],b=(0,O.useContext)(p.Z),A=b.lang,$=b.notice,s=b.message,i=function(){S(!0);var e=t.action();e instanceof Promise?e.then(function(I){if(S(!1),I){typeof t.onSuccess=="function"&&t.onSuccess(I);var U="";t.messageSuccess?typeof t.messageSuccess=="function"?U=t.messageSuccess(I):U=t.messageSuccess.indexOf("notification.")==0?A(t.messageSuccess):t.messageSuccess:U=A("notification.finish"),t.asynced?s.info(U):s.success(U)}}).catch(function(I){S(!1),typeof t.onError=="function"&&t.onError(I)}):S(!1)};return t.confirm?(0,f.jsx)(g.Z,{style:{width:500},title:t.confirmTitle?t.confirmTitle:A("notification.title.tip"),description:typeof t.confirm=="string"&&t.confirm.indexOf("notification.")==0?A(t.confirm):t.confirm,onConfirm:i,okText:"Yes",cancelText:"No",onOpenChange:t.confirmOnOpenChange,children:(0,f.jsx)(E.ZP,{block:t.block,disabled:t.disabled,icon:t.icon,loading:P,danger:t.danger,type:t.type,children:t.children})}):(0,f.jsx)(x.Z,{title:t.tips,children:(0,f.jsx)(E.ZP,{block:t.block,style:t.ghost?{padding:0,height:"auto"}:{},disabled:t.disabled,icon:t.icon,loading:P,onClick:i,danger:t.danger,type:t.type,children:t.children})})}},24963:function(z,C,n){var _=n(67294),l=(0,_.createContext)({});C.Z=l},29337:function(z,C,n){n.r(C),n.d(C,{default:function(){return te}});var _=n(15009),l=n.n(_),p=n(99289),g=n.n(p),E=n(5574),x=n.n(E),O=n(24963),f=n(15078),M=n(184),t=n(5966),B=n(97462),W=n(86615),P=n(62370),S=n(82346),b=n(28036),A=n(42075),$=n(25593),s=n(66309),i=n(38925),d=n(67294),e=n(85893),I=(0,d.forwardRef)(function(m,G){var w=(0,d.useState)(!1),Z=x()(w,2),h=Z[0],a=Z[1],y=(0,d.useRef)(),F=(0,d.useContext)(O.Z),o=F.message,R=F.notice,u=(0,S.useSearchParams)(),v=x()(u,2),re=v[0],ae=v[1];return(0,d.useImperativeHandle)(G,function(){return{edit:function(c){var r;(r=y.current)===null||r===void 0||r.setFieldsValue({title:c.title,name:c.name,type:c.setting.type,url:c.setting.url,id:c.id}),a(!0)}}}),(0,d.useEffect)(function(){re.get("op")=="create"&&a(!0)},[]),(0,e.jsxs)(M.a,{name:"create",title:"\u6DFB\u52A0\u7B2C\u4E09\u65B9\u5E94\u7528\u5546\u5E97",open:h,onOpenChange:function(c){var r;!c&&((r=y.current)===null||r===void 0||r.resetFields()),a(c)},drawerProps:{forceRender:!0},formRef:y,trigger:(0,e.jsx)(b.ZP,{type:"primary",children:"\u6DFB\u52A0\u7B2C\u4E09\u65B9\u5E94\u7528\u5546\u5E97"}),onFinish:function(){var K=g()(l()().mark(function c(r){var D,T,L;return l()().wrap(function(j){for(;;)switch(j.prev=j.next){case 0:return r.type=="1panel-local"&&(r.url="/dpanel/store/".concat(r.name)),j.next=3,(0,f.ks)({name:r.name,url:r.url,type:r.type});case 3:if(D=j.sent,!(D&&D.data)){j.next=13;break}return j.next=7,(0,f.$c)({id:r.id,name:r.name,title:r.title,type:r.type,url:r.url,apps:D.data.list});case 7:if(T=j.sent,!(T&&T.data)){j.next=13;break}return o.success("\u6DFB\u52A0\u7B2C\u4E09\u65B9\u5E94\u7528\u5546\u5E97\u6210\u529F"),m.onFinish&&m.onFinish(),(L=y.current)===null||L===void 0||L.resetFields(),j.abrupt("return",!0);case 13:case"end":return j.stop()}},c)}));return function(c){return K.apply(this,arguments)}}(),children:[(0,e.jsx)(t.Z,{name:"id",hidden:!0}),(0,e.jsx)(t.Z,{label:"\u540D\u79F0",name:"title",required:!0,rules:[{required:!0}],placeholder:"\u7528\u4E8E\u533A\u5206\u4E0D\u540C\u7684\u5E94\u7528\u5546\u5E97"}),(0,e.jsx)(B.Z,{name:["id"],children:function(c){var r=c.id;return(0,e.jsx)(t.Z,{label:"\u6807\u8BC6",name:"name",required:!0,disabled:!!r,rules:[{required:!0}],placeholder:"\u6307\u5B9A\u5546\u5E97\u6807\u8BC6\uFF0C\u7528\u4E8E\u521B\u5EFA\u5546\u5E97\u6587\u4EF6\u5B58\u50A8\u76EE\u5F55"})}}),(0,e.jsx)(W.Z.Group,{name:"type",label:"\u5546\u5E97\u7C7B\u578B",valueEnum:{casaos:"casaos","1panel":"1panel","1panel-local":"1panel \u672C\u5730"},fieldProps:{onChange:function(c){var r;(r=y.current)===null||r===void 0||r.resetFields(["url"])}}}),(0,e.jsx)(B.Z,{name:["type","name"],children:function(c){var r=c.type,D=c.name,T=[],L=[];return r=="1panel"&&(L=["https://gitee.com/qyg2297248353/appstore-dpanel","https://github.com/1Panel-dev/appstore","https://github.com/okxlin/appstore"],T=[(0,e.jsx)(t.Z,{label:"\u4ED3\u5E93\u5730\u5740",name:"url",required:!0,rules:[{required:!0}],placeholder:"\u8BF7\u8F93\u5165\u8FDC\u7A0B git \u4ED3\u5E93\u5730\u5740\u6216\u662F\u9762\u677F /dpanel/store \u4E0B\u7684\u5B50\u76EE\u5F55\u540D"},"gitUrl")]),r=="portainer"&&(T=[(0,e.jsx)(t.Z,{label:"template.json \u5730\u5740",name:"url",required:!0,rules:[{required:!0}],placeholder:"https://github.com/Lissy93/portainer-templates/blob/main/templates.json"},"jsonUrl")]),r=="casaos"&&(L=["https://play.cuse.eu.org/Cp0204-AppStore-Play.zip"],T=[(0,e.jsx)(t.Z,{label:"zip \u5730\u5740",name:"url",required:!0,rules:[{required:!0}],placeholder:"\u8BF7\u8F93\u5165\u8FDC\u7A0B zip \u5730\u5740"},"zipUrl")]),r&&r!="1panel-local"?[T,(0,e.jsx)(P.Z,{label:(0,e.jsxs)(A.Z,{children:["\u63A8\u8350\u5546\u5E97",(0,e.jsx)("a",{href:"https://dpanel.cc/#/zh-cn/manual/setting/store?id=%e6%94%af%e6%8c%81%e7%b1%bb%e5%9e%8b",target:"_blank",children:"\u4E09\u65B9\u5546\u5E97\u63A5\u5165\u8BF4\u660E"})]}),children:(0,e.jsx)(A.Z,{wrap:!0,children:L.map(function(N,j){return(0,e.jsx)($.Z.Link,{onClick:function(){var V;(V=y.current)===null||V===void 0||V.setFieldValue("url",N)},children:(0,e.jsx)(s.Z,{color:"cyan",children:N})},j)})})},"recommend")]:[T,(0,e.jsx)(P.Z,{children:(0,e.jsx)(i.Z,{message:"\u65B0\u5EFA /dpanel/store/".concat(D!=null?D:""," \u76EE\u5F55\uFF0C\u5E76\u81EA\u884C\u4E0B\u8F7D\u6216\u662F\u6DFB\u52A0\u5E94\u7528")})},"local-description")]}})]})}),U=I,J=n(80821),H=n(5251),Y=n(67255),k=n(43425),Q=n(98165),X=n(90078),q=n(78099),ee=n(96074),ne=n(83062);function te(){var m=(0,d.useRef)(),G=(0,S.useAccess)(),w=(0,d.useRef)();return(0,e.jsx)(X._z,{header:{extra:[G.canSeeFounder&&(0,e.jsx)(U,{ref:w,onFinish:function(){var h,a;!((h=m.current)===null||h===void 0)&&h.reloadAndRest&&((a=m.current)===null||a===void 0||a.reloadAndRest())}},"create")]},children:(0,e.jsx)(q.Z,{scroll:{x:"max-content"},rowKey:"id",pagination:(0,Y.O)(),columns:[{title:"\u6807\u8BC6",dataIndex:"name",width:200},{title:"\u540D\u79F0",dataIndex:"title"},{title:"\u5730\u5740",width:500,search:!1,render:function(h,a,y,F,o){return(0,e.jsx)("a",{href:a.setting.url,target:"_blank",children:(0,e.jsx)(s.Z,{children:a.setting.url})})}},{title:"\u6700\u540E\u66F4\u65B0",width:180,render:function(h,a,y,F,o){if(a.setting.updatedAt)return(0,H.ZM)(a.setting.updatedAt*1e3)}},{title:"\u64CD\u4F5C",width:100,search:!1,fixed:"right",render:function(h,a,y,F,o){return(0,e.jsxs)(A.Z,{split:(0,e.jsx)(ee.Z,{type:"vertical"}),children:[(0,e.jsx)($.Z.Link,{onClick:function(){var u;(u=w.current)===null||u===void 0||u.edit(a)},children:(0,e.jsx)(ne.Z,{title:"\u7BA1\u7406",children:(0,e.jsx)(k.Z,{})})},"manage"),(0,e.jsx)(J.Z,{type:"link",icon:(0,e.jsx)(Q.Z,{}),action:function(){var u,v;return(0,f.ks)({id:a.id,name:a.name,url:(u=a.setting.url)!==null&&u!==void 0?u:"",type:(v=a.setting.type)!==null&&v!==void 0?v:""})},onSuccess:function(){var u,v;return!((u=m.current)===null||u===void 0)&&u.reloadAndRest&&((v=m.current)===null||v===void 0||v.reloadAndRest()),!0},onError:function(){var u,v;return!((u=m.current)===null||u===void 0)&&u.reloadAndRest&&((v=m.current)===null||v===void 0||v.reloadAndRest()),!0},children:" "},"upgrade")]})}}],request:function(){var Z=g()(l()().mark(function h(a,y,F){var o;return l()().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.next=2,(0,f.eO)({name:a.name,title:a.title});case 2:return o=u.sent,u.abrupt("return",{data:o.data.list,success:!0,total:o.data.list.length});case 4:case"end":return u.stop()}},h)}));return function(h,a,y){return Z.apply(this,arguments)}}(),rowSelection:{defaultSelectedRowKeys:[],alwaysShowAlert:!0},actionRef:m,tableAlertOptionRender:function(h){var a=h.selectedRowKeys,y=h.selectedRows;return(0,e.jsx)(A.Z,{size:16,children:(0,e.jsx)(J.Z,{danger:!0,type:"primary",action:function(){return(0,f.Me)({id:y.map(function(o){return o.id})})},onSuccess:function(){var o,R;return!((o=m.current)===null||o===void 0)&&o.reloadAndRest&&((R=m.current)===null||R===void 0||R.reloadAndRest()),!0},onError:function(){var o,R;return!((o=m.current)===null||o===void 0)&&o.reset&&((R=m.current)===null||R===void 0||R.reset()),!0},confirm:"notification.confirm.title",children:"\u6279\u91CF\u5220\u9664"},"delete")})}})})}},15078:function(z,C,n){n.d(C,{$c:function(){return x},Me:function(){return S},eO:function(){return W},ks:function(){return f},yL:function(){return A}});var _=n(15009),l=n.n(_),p=n(99289),g=n.n(p),E=n(82346);function x(s){return O.apply(this,arguments)}function O(){return O=g()(l()().mark(function s(i){return l()().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,E.request)("/api/common/store/create",{method:"POST",data:i}));case 1:case"end":return e.stop()}},s)})),O.apply(this,arguments)}function f(s){return M.apply(this,arguments)}function M(){return M=g()(l()().mark(function s(i){return l()().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,E.request)("/api/common/store/sync",{method:"POST",data:i}));case 1:case"end":return e.stop()}},s)})),M.apply(this,arguments)}function t(s){return B.apply(this,arguments)}function B(){return B=_asyncToGenerator(_regeneratorRuntime().mark(function s(i){return _regeneratorRuntime().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",request("/api/common/store/get-detail",{method:"POST",data:i}));case 1:case"end":return e.stop()}},s)})),B.apply(this,arguments)}function W(s){return P.apply(this,arguments)}function P(){return P=g()(l()().mark(function s(i){return l()().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,E.request)("/api/common/store/get-list",{method:"POST",data:i}));case 1:case"end":return e.stop()}},s)})),P.apply(this,arguments)}function S(s){return b.apply(this,arguments)}function b(){return b=g()(l()().mark(function s(i){return l()().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,E.request)("/api/common/store/delete",{method:"POST",data:i});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},s)})),b.apply(this,arguments)}function A(s){return $.apply(this,arguments)}function $(){return $=g()(l()().mark(function s(i){return l()().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,E.request)(i==null?void 0:i.path,{method:"GET"}));case 1:case"end":return e.stop()}},s)})),$.apply(this,arguments)}},67255:function(z,C,n){n.d(C,{O:function(){return _},j:function(){return l}});function _(){var p=localStorage.getItem("dpanel-pagesize");return p=="all"?!1:{showSizeChanger:!0,defaultPageSize:parseInt(p!=null?p:"20")}}function l(p){var g="dpanel-table-column-".concat(p),E={};if(localStorage.getItem(g)){var x;E=JSON.parse((x=localStorage.getItem(g))!==null&&x!==void 0?x:"{}")}return{defaultValue:E,onChange:function(f){localStorage.setItem("dpanel-table-column-".concat(p),JSON.stringify(f))}}}}}]);
